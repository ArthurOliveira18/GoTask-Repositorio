-- Criação do schema
CREATE SCHEMA IF NOT EXISTS gotask DEFAULT CHARACTER SET utf8;
USE gotask;

-- Tabela Pai
CREATE TABLE IF NOT EXISTS responsavel (
  idResp INT NOT NULL AUTO_INCREMENT,
  Email VARCHAR(50) NOT NULL UNIQUE,
  Senha VARCHAR(25) NOT NULL UNIQUE,
  Nome_Resp VARCHAR(45) NOT NULL,
  PRIMARY KEY (idResp)
);
SELECT * FROM responsavel;
insert into responsavel (Email, Senha,  Nome_Resp)
values ("aaa@gmail.com" , "aaaa" , "aaazinho");


-- Tabela Crianca
CREATE TABLE IF NOT EXISTS crianca (
  idCrianca INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  nomeCrianca VARCHAR(45) NOT NULL,
  dtNasc DATE,
  pontos INT NOT NULL,
  responsavel INT NOT NULL,
  CONSTRAINT fk_Crianca_Pai
    FOREIGN KEY (responsavel)
    REFERENCES responsavel (idResp)
);

-- Tabela Task
CREATE TABLE IF NOT EXISTS task (
  idTask INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Nome_task VARCHAR(45) NOT NULL,
  Pontos_task INT NOT NULL,
  status INT NOT NULL
);

-- Tabela Beneficio
CREATE TABLE IF NOT EXISTS beneficio (
  idBeneficio INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  Nome_ben VARCHAR(100) NOT NULL,
  pontos_ben INT NOT NULL DEFAULT 0
);

-- Tabela Historico_Task
CREATE TABLE IF NOT EXISTS historicoTask (
  idCrianca INT NOT NULL,
  idTask INT NOT NULL,
  dia SET("seg", "ter", "qua", "qui", "sex", "fds") NOT NULL,
  feita TINYINT NOT NULL,
  data DATETIME NOT NULL,
  PRIMARY KEY (idCrianca, idTask, data), 
  CONSTRAINT crianca_historico_T
    FOREIGN KEY (idCrianca)
    REFERENCES crianca (idCrianca),
  CONSTRAINT task_historico
    FOREIGN KEY (idTask)
    REFERENCES task (idTask)
);

-- Tabela Historico_Beneficio
CREATE TABLE IF NOT EXISTS historicoBeneficio (
  idCrianca INT NOT NULL,
  idBeneficio INT NOT NULL,
  data DATETIME NOT NULL,
  valor INT NOT NULL,
  PRIMARY KEY (idCrianca, idBeneficio, data),
  CONSTRAINT crianca_historico_B
    FOREIGN KEY (idCrianca)
    REFERENCES crianca (idCrianca),
  CONSTRAINT beneficio_historico
    FOREIGN KEY (idBeneficio)
    REFERENCES beneficio (idBeneficio)
);
